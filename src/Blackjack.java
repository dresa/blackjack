/*
 * @(#)Blackjack.java 29.4.2003
 *
 * Tiedosto sisältää myös luokkien HoiteleIkkunanSulkeminen
 * ja PiilotaOhjeIkkuna lähdekoodin.
 * 
 * Copyright 2003 Esa Junttila
 */

import java.awt.*;
import java.awt.event.*;

/**
 * Blackjack on pelin pääohjelmaluokka. Blackjack huolehtii korttien vetämisestä,
 * korttien välisistä viiveistä ja käyttöliittymän oikeasta puolesta (napit,
 * vinkkiruutu, panos ja saldo).<p>
 * Ruudun päivityksestä vastaa metodi <tt>refresh()</tt>, jota kutsutaan joka kerta kun
 * Kasien korttimäärä vaihtuu (ja useamminkin). Refresh sisaltaa myos kutsun
 * käyttöliittymän vasemman puolen päivittävään <tt>KorttiGUI</tt>-luokan metodiin
 * <tt>paivitaKortit()</tt>. Jokaisen päivityksen yhteydessä päivitetään kaikki mahdollinen.
 * <p> Jos ohjelma yrittää asettaa <tt>null</tt>-arvoa Kasi-olioon väkisin tai
 * yrittää luoda Pelikierrosta Korttipakan asemesta <tt>null</tt>-arvolla, ohjelman
 * annetaan kaatua.
 *
 * @author  Esa Junttila
 * @version 29.4.2003
 */
public class Blackjack extends Frame 
                       implements ActionListener, MouseListener {

    /**
     * Blackjack-pelin käynnistysmetodi
     */
    public static void main(String[] args) {
         Blackjack ikkuna = new Blackjack();
         ikkuna.setSize(640,480);
         ikkuna.setTitle("Blackjack by Esa");
         ikkuna.setVisible(true);
    }

  //-------KOMPONENTTIEN KOOT:
    /** Kuinka leveä on vinkkiruutu*/
    private static final int VINKKIRUUDUN_LEVEYS = 6;


  //-------VÄRIT:
    /** Blackjackin peli-ikkunan taustaväri*/
    private static final Color IKKUNAN_TAUSTAVARI = new Color(0, 128, 0); //tummanvihrea
    
    /** Vinkkiruudun taustaväri */
    private static final Color VINKKIRUUDUN_VARI = new Color(128, 255, 255); //vaaleansininen
    
    /** Editoitavan panosruudun väri */
    private static final Color PANOSRUUDUN_VARI = Color.WHITE;
    
    /** Ei-editoitavan panosruudun väri */
    private static final Color PANOSRUUTU_EI_EDITOINTIA = SystemColor.control; //Tekstikenttien haalea tausta.
    
    /** Minkä värisiä ovat virheilmoitukset */
    private static final Color VIRHEVARI = new Color(255, 100, 100); //melko vahva punainen


  //-------FONTIT:
    /** Millaisella fontilla vinkkitekstit tulostuvat vinkkiruutuun*/
    private static final Font VINKKIFONTTI = new Font("SansSerif", Font.BOLD, 16); //fontti, tehosteet, koko
    
    /** Millaisella fontilla panoksen ja saldon suuruus kirjoitetaan vastaaviin ruutuihin*/
    private static final Font SALDOPANOSFONTTI = new Font("SansSerif", Font.BOLD, 16);

    /** Millaisella fontilla "Panos"- ja "Saldo"-tekstit kirjoitetaan ikkunaan */
    private static final Font SALDOPANOSTEKSTIFONTTI = new Font("SansSerif", Font.PLAIN, 14);


  //-------VIIVE:
    /** Minkä pituista viivettä käytetään kortinottojen välissä */
    private static final int ODOTUSAIKA = 0; //hyvä arvo n. 1000 = 1 s


  //-------MUUT VAKIOT:
    /** Mitä vinkkiruudussa lukee oletuksena kun vinkkiä ei ole vielä haettu */
    private static final String OLETUSVINKKI = "VINKKI";


  //-------MUUTTUJAT:
    /** Mitä ja minkä kokoista pakkaa tämä Blackjack-peli käyttää*/
    private Korttipakka pakka = new Korttipakka(Saannot.PAKALLISIA_PELISSA);
    
    /** Blackjack-pelin alussa annettavan rahamäärän suuruus*/
    private int rahaa = 100;

    /** Kun peli käynnistetään, mikä panoksen suuruus on oletuksena*/
    private int peruspanos = 10;
    
    /** Apumuuttuja pelin panoksen selvittämiseen*/
    private int pelinPanos = this.peruspanos;

    /** Meneillään oleva Pelikierros*/
    private Pelikierros peli;


//------- GRAAFISEN KAYTTOLIITTYMAN KOMPONENTIT:
//----------------------------------------------
    private KorttiGUI korttialue;   // KorttiGUI extends Panel. Käyttöliittymän vasen puoli.
  //-------
    private Panel nappialue; //Käyttöliittymän oikea puoli

    private Panel erikoisnapit;
    private Button nappi_tuplaus = new Button("Tuplaa");
    private Button nappi_jaaPeli = new Button("Jaa käsi");
    private Button nappi_vakuutus = new Button("Vakuuta");

    private Panel saldopanosalue;
    private Panel panosrivi;
    private Panel saldorivi;
    private TextField panosruutu = new TextField("", 3);
    private Label saldoruutu = new Label("", Label.RIGHT);
    private Label panosteksti = new Label("Panos:", Label.RIGHT);
    private Label saldoteksti = new Label("Saldo:", Label.RIGHT);

    private Button nappi_ota = new Button("Ota kortti");
    private Button nappi_jaaTahan = new Button("Jää tähän");
    private Button nappi_uusiPelikierros = new Button("Jaa uusi peli");

    private Panel ohjealue;
    private Button nappi_ohje = new Button("Ohje");
    private Button valenappi_1 = new Button("valenappi_1"); //luomassa tyhjää tilaa

    private Panel lopetusalue;
    private Button nappi_lopetus = new Button("Lopeta peli");
    private Button valenappi_2 = new Button("valenappi_2"); //luomassa tyhjää tilaa

    private Panel vinkkialue;
    private TextField vinkkiruutu = new TextField(OLETUSVINKKI, VINKKIRUUDUN_LEVEYS);

    private Dialog ohjeikkuna;


    /**
     * Asettaa käyttöliittymän ja valmistautuu aloittamaan ensimmäisen Pelikierroksen.
     */
    public Blackjack() {
         //Haetaan "edellisen kierroksen" lopputila, jotta voitaisiin muokata panosta
         peli = new Pelikierros(this.rahaa, this.peruspanos); 

         this.setLayout(new FlowLayout(FlowLayout.LEFT, 5, 0));  //align, h-gap, v-gap
         this.setBackground(IKKUNAN_TAUSTAVARI);
       //-------         
         this.korttialue = new KorttiGUI(this.peli);
         this.nappialue = new Panel(new GridLayout(4, 2, 8, 20) );

//-------
         this.erikoisnapit = new Panel(new GridLayout(3, 1, 0, 10) );
         this.erikoisnapit.add(this.nappi_tuplaus);
         this.erikoisnapit.add(this.nappi_jaaPeli);
         this.erikoisnapit.add(this.nappi_vakuutus);
         this.nappialue.add(this.erikoisnapit);      
       //--
         this.nappialue.add(this.vinkkiruutu);
         this.vinkkiruutu.setEditable(false);
         this.vinkkiruutu.setFont(VINKKIFONTTI);
         this.vinkkiruutu.setBackground(VINKKIRUUDUN_VARI);
       //--
         this.nappialue.add(this.nappi_ota);
         this.nappialue.add(this.nappi_jaaTahan);
         
       //-------
         this.saldopanosalue = new Panel(new GridLayout(2,1,0,10) ); //rows,cols,hgap,vgap

         this.panosrivi = new Panel(new FlowLayout(FlowLayout.LEFT,0,0)); //align, hgap, vgap
         this.panosrivi.add(this.panosteksti);
         this.panosrivi.add(this.panosruutu);
         this.saldopanosalue.add(this.panosrivi);

         this.saldorivi = new Panel(new FlowLayout(FlowLayout.LEFT,0,0));
         this.saldorivi.add(this.saldoteksti);
         this.saldorivi.add(this.saldoruutu);
         this.saldopanosalue.add(this.saldorivi);

         this.panosruutu.setFont(SALDOPANOSFONTTI);
         this.panosteksti.setFont(SALDOPANOSTEKSTIFONTTI);
         this.saldoruutu.setFont(SALDOPANOSFONTTI);
         this.saldoteksti.setFont(SALDOPANOSTEKSTIFONTTI);

         this.nappialue.add(this.saldopanosalue);
       //-------

         this.nappialue.add(this.nappi_uusiPelikierros);

         this.ohjealue = new Panel(new GridLayout(2,1,0,10)); //rows,cols,hgap,vgap
         this.ohjealue.add(this.valenappi_1);
         this.ohjealue.add(this.nappi_ohje);
         this.nappialue.add(this.ohjealue);

         this.lopetusalue = new Panel(new GridLayout(2,1,0,10)); //rows,cols,hgap,vgap
         this.lopetusalue.add(this.valenappi_2);
         this.lopetusalue.add(this.nappi_lopetus);
         this.nappialue.add(this.lopetusalue);

         //valenapit ovat aina piilossa. Ne ovat vain luomassa tyhjaa tilaa ruudulle.
         this.valenappi_1.setVisible(false);
         this.valenappi_2.setVisible(false);

         this.add(this.korttialue);
         this.add(this.nappialue);

      //-------
         this.luoOhjeikkuna();
    //------------
    //--TAPAHTUMAKUUNTELIJAT:
         this.nappi_uusiPelikierros.addActionListener(this);
         this.nappi_lopetus.addActionListener(this);
         this.nappi_ohje.addActionListener(this);
         this.nappi_ota.addActionListener(this);
         this.nappi_jaaTahan.addActionListener(this);
         this.nappi_tuplaus.addActionListener(this);
         this.nappi_jaaPeli.addActionListener(this);
         this.nappi_vakuutus.addActionListener(this);

         this.vinkkiruutu.addMouseListener(this);
        
         this.addWindowListener(new HoiteleIkkunanSulkeminen());

         this.refresh();
    }

    /**
     * Metodi suorittaa halutun Blackjackin toiminnon ja
     * ohjaa peliä oikeaan suuntaan. Tässä tapahtuu koko
     * Blackjack-pelin ylin kontrolli. Metodi hoitaa myös
     * pelikierroksen lopussa tehtävät toimenpiteet.
     */
    public void actionPerformed(ActionEvent tapahtuma) {
         Object aiheuttaja = tapahtuma.getSource();
         
         // Kenellä oli vuoro ennen kuin tehtiin *toiminto*
         int vanhaVuoro = this.peli.kenenVuoro();

         if (aiheuttaja == this.nappi_ota)
              this.suoritaLisakortti();
         else if (aiheuttaja == this.nappi_jaaTahan)
              this.suoritaSeis();
         else if (aiheuttaja == this.nappi_tuplaus)
              this.suoritaTuplaus();
         else if (aiheuttaja == this.nappi_jaaPeli)
              this.suoritaKadenJako();
         else if (aiheuttaja == this.nappi_vakuutus)
              this.suoritaVakuutus();
         else if (aiheuttaja == this.nappi_uusiPelikierros)
              this.jaaUusiKierros();
         else if (aiheuttaja == this.nappi_ohje)
              this.ohjeikkuna.show(); //Tuodaan ohjeikkuna näkyviin.
         else if (aiheuttaja == this.nappi_lopetus)
              this.lopetus(); //Ohjelma sammuu.

         this.refresh();

         // Kenellä on vuoro *toiminnon* jälkeen
         int uusiVuoro = this.peli.kenenVuoro();

         //Peli jaettiin ja vuoro siirtyi pelaajan ekalle jaetulle kädelle
         if (vanhaVuoro == 1 && uusiVuoro == 2) {
              this.odota(ODOTUSAIKA);
              this.peli.lisaa();         //vuoro==2, toinen kortti pelaajan ekalle jaetulle kadelle
              this.refresh();

              //(Jos pelaaja jakoi kaksi ässää, lisaa()-metodi vaihtoi heti vuoron pelaajalle tokalle kädelle)
              if (this.peli.kenenVuoro() == 3) { //Kavi siis niin etta pelaaja jakoi kaksi assaa.
                   this.odota(ODOTUSAIKA);       //Seka pelaaja 1 etta 2 saavat (vain) yhden kortin.
                   this.peli.lisaa();         
                   this.refresh();              
              }
         }
         //Vuoro siirtyy normaalisti pelaajan ekalta jaetulta kädeltä toiselle
         else if (vanhaVuoro == 2 && uusiVuoro == 3) {
              this.odota(ODOTUSAIKA);
              this.peli.lisaa();         //vuoro==3, toinen kortti pelaajan tokalle jaetulle kadelle
              this.refresh();
         }
         
         // Lopulta vuoro ei ole enää pelaajalla vaan jakajalla
         if (this.peli.kenenVuoro() == 4) { //jakajan vuoro
              if ( Saannot.ottaakoJakajaKortin(peli) ) {  //Otetaanko kortteja ylipaataan?
                   boolean jatketaan = true;
                   while( jatketaan ) {
                        this.odota(ODOTUSAIKA);
                        jatketaan = this.peli.lisaa(); //Jakaja saa kortteja kunnes lisaa()==false
                        this.refresh();
                   }
              }

              //pakan sekoitus kierroksen loppuun:
              if (Saannot.pitaakoPakkaSekoittaa(this.pakka) ) {
                   this.pakka.sekoitaPakka();
                   this.ilmoitaPakanSekoittamisesta();
              }
              //Lopetetaan pelikierros ( vuoro 4 --> -1 )
              this.peli.vaihdaVuoroa();
              this.rahaa = this.peli.rahatilanne(); //Rahojen paivitys kierroksen päätteksi
         }
         this.refresh();
    }


    /** Pelaaja halusi ottaa lisäkortin*/
    private void suoritaLisakortti() {
         this.peli.lisaa();
    }

    /** Pelaaja halusi jäädä pistelukuunsa */
    private void suoritaSeis() {
         this.peli.vaihdaVuoroa();
    }

    /** Pelaaja halusi tuplata pelinsä */
    private void suoritaTuplaus() {  //Peli tuplataan. Yksi lisakortti ja siirrytaan jakajan vuoroon.
         this.peli.tuplaa();
         this.peli.lisaa(); //ainoa lisäkortti (pakollinen)
         this.peli.vaihdaVuoroa(); //(vuoro siirtyy väkisinkin jakajalle)
         this.refresh();
         this.odota(ODOTUSAIKA);
    }

    /** Pelaaja halusi jakaa pelinsä*/
    private void suoritaKadenJako() {
         try {
              this.peli.jaaPeli();       //(AIHEUTTAA POIKKEUKSEN, JOS kutsutaan 'new Kasi(pakka, null)' )
         } catch (Exception e) {
              System.out.println("Tapahtui mahtivirhe: " + e + "  Jokin metodi kutsui 'new Kasi(pakka, null)'!");
         }
         this.peli.vaihdaVuoroa(); //Vuoro siirretään pelaajan ekalle jaetulle kädelle
    }

    /** Pelaaja halusi vakuuttaa pelinsä*/
    private void suoritaVakuutus() {
         this.peli.vakuuta();
    }

    /** Pelaaja halusi osallistui uuteen Pelikierrokseen*/
    private void jaaUusiKierros() {

              //Panoksen ja saldon tarkistus: (panos haetaan käyttöliittymässä olevasta panosruudusta)
              int asetettavaPanos;
              try{
                   asetettavaPanos = Integer.parseInt(this.panosruutu.getText() );
              }
              catch (NumberFormatException e) {
                   this.virheellinenPanos();
                   return;
              }

              //Panoksen on oltava kahdella jaollinen kokonaisluku.
              //Myos rahaa pitaa olla tarpeeksi. Nollapanos hyväksytään.
              if (asetettavaPanos < 0 || asetettavaPanos > this.rahaa || asetettavaPanos%2 == 1) {
                   
                   //Tehdään virheilmoitus
                   this.virheellinenPanos();
                   
                   //Jos panos oli liian suuri, ehdotetaan rahavaroille suurinta mahdollista panosta
                   if (asetettavaPanos > this.rahaa)
                        this.peruspanos = this.rahaa - this.rahaa%2;
                   return;
              }
              else this.korttialue.muutaInforuutua("", false); // Panos kunnossa --> Inforuutu piiloon

              this.peruspanos = asetettavaPanos;

              //vinkkiruudun oletusarvot:
              this.vinkkiruutu.setText(OLETUSVINKKI);

              //Otetaan käyttöön uusi Pelikierros (AIHEUTTAA POIKKEUKSEN, JOS this.pakka==null)
              try {
                   this.peli = new Pelikierros(this.pakka, this.rahaa, this.peruspanos);
              } catch (Exception e) {
                   System.out.println("Tapahtui mahtivirhe: " + e + "  Jokin metodi kutsui 'new Pelikierros(null, int, int)'!");
              }

              //Päivitetään käyttöliittymän vasemman puolen tiedot Pelikierroksesta
              this.korttialue.vaihdaPelia(this.peli);
              this.refresh();

              //Jaetaan Pelikierroksen alussa tarvittavat kolme korttia
              boolean jatketaan = true;
              while (jatketaan) {
                   this.odota(ODOTUSAIKA);
                   jatketaan = this.peli.alkukortit();
                   this.refresh();
              }

    }

// HIIRITAPAHTUMAT:
    /** Vinkkiruutuun liittyvä hiiren napin klikkaus ei tee mitään*/
    public void mouseClicked(MouseEvent e) {
    }

    /**
     * Vinkkiruutuun liittyvä hiiren "sisääntulo" vinkkiruutuun tuo
     * pelitilannetta vastaavan vinkin näkyviin
     */
    public void mouseEntered(MouseEvent e) {
          this.vinkkiEsiin();
    }

    /** Vinkkiruutuun liittyvä hiiren liikkuminen ruudulla ei tee mitään*/
    public void mouseExited(MouseEvent e) {
    }

    /** Vinkkiruutuun liittyvä hiiren napin painaminen ei tee mitään*/
    public void mousePressed(MouseEvent e) {
    }

    /** Vinkkiruutuun liittyvä hiiren napin vapauttaminen ei tee mitään*/
    public void mouseReleased(MouseEvent e) {
    }


    /**
     * Ohjelman suoritus pysähtyy parametrina saadun arvon ajaksi (millisekunteja).
     * <p>Odottamiseen liittyy ongelma. Jos koodissa piirretään kortin kuva
     * ja pistetään ohjelma sen jälkeen tauolle esim. 1000 millisekunniksi,
     * Java tulkitsee asian niin, että ohjelma odottaa sekunnin ja piirtää kortin
     * kuvan vasta sitten! Missä järki?!
     */
    private void odota(int odotusaika) {
         try {
              Thread.sleep(odotusaika);
         } catch (InterruptedException e) {
              System.out.println("Thread.sleep(odotusaika) aiheutti poikkeuksen!");
         }
    }

    /**
     * Päivittää käyttöliittymän vastaamaan Pelikierroksella vallitsevaa tilannetta.
     * Napit, jotka eivät ole pelitilanteen mukaan mahdollisia, poistuvat näkyvistä
     * tai ainakin muuttuvat harmaiksi. Pelaajan saldo ja panos voivat myös muuttua
     * metodin kutsun yhteydessä. Itse metodi hoitaa käyttöliittymän oikean puolen,
     * mutta se kutsuu samalla myös käyttöliittymän vasemman puolen päivittavaa
     * KorttiGUI:n metodia paivitaKortit().
     */
    public void refresh() {

       //-- Ovatko toiminnot mahdollisia
         this.nappi_tuplaus.setVisible( Saannot.voikoPelaajaTuplataKaden(this.peli) );
         this.nappi_jaaPeli.setVisible( Saannot.voikoPelaajaJakaaKaden(this.peli) );
         this.nappi_vakuutus.setVisible( Saannot.voikoPelaajaVakuuttaaKaden(this.peli) );
         this.nappi_ota.setEnabled( Saannot.voikoPelaajaOttaaKortin(this.peli) );
         this.nappi_jaaTahan.setEnabled( Saannot.voikoPelaajaJaada(this.peli) );

         //Uusi jako vain jos edellinen kierros on paattynyt.
         this.nappi_uusiPelikierros.setEnabled( this.peli.kenenVuoro() == -1); 
      
       //-- Jos vinkkiruutua on katsottu pelikierroksen aikana, vinkki paivittyy itsestaan.
         if ( !vinkkiruutu.getText().equals(OLETUSVINKKI)) //onko oletusteksti edelleen näkyvillä?
              this.vinkkiEsiin();
              

       //-- Rahatilanteen paivitys
         this.rahaa = this.peli.rahatilanne();
         this.pelinPanos = this.peli.panostilanne();
       
         this.saldoruutu.setText("" + this.rahaa); //saldoruutu heijastelee aina kadessa olevaa rahamaaraa.
                                              //Panokset ovat "pelialueella".

       //-- Panosruutu:
         if (peli.kenenVuoro() == -1) {  //Kun peli ei ole kaynnissa, sallitaan panoksen muuttaminen
             this.panosruutu.setBackground(PANOSRUUDUN_VARI); //editoitava valkoinen
             
             //Palautetaan panosruutuun edellisen kierroksen alkuperainen panosmaara
             this.panosruutu.setText("" + this.peruspanos); 
             
             //Panosta voi muuttaa
             this.panosruutu.setEditable(true); 
                                                
         }
         else {
             this.panosruutu.setBackground(PANOSRUUTU_EI_EDITOINTIA); //harmaa tausta
             this.panosruutu.setEditable(false);
             this.panosruutu.setText("" + peli.panostilanne());
         }

         this.korttialue.paivitaKortit();
         this.validate();
    }

    /** Sulkee ohjelman aikailematta */
    private void lopetus() {    
         System.exit(0);  // ikkunan ja koko ohjelman sulkeminen
    }

    /** Hakee pelitilanteeseen sopivan vinkin ja tuo sen näkyville vinkkiruutuun*/
    private void vinkkiEsiin() {
         String vinkki = this.peli.haeVinkki();
         if (vinkki == null)
              return;
         
         if (vinkki.indexOf("VIRHE") != -1) {
              this.virheellinenVinkki(vinkki); //Vilautetaan virhetekstiä inforuudussa
         }
         else
              this.vinkkiruutu.setText(vinkki);   
    }

    /**
     * Jos pelaaja yrittää pelata virheelisellä panoksella, panosruutu
     * välähtää virhevärillä ja inforuutu tuo esiin, miksi panos oli
     * virheellinen.
     */
    private void virheellinenPanos() {
         this.panosruutu.setBackground(VIRHEVARI);
         this.korttialue.muutaInforuutua("Panos on virheellinen!\n" +
                                         "- Panoksen on oltava kahdella jaollinen\n" +
                                         "- Panos ei saa ylittää rahavaroja", true);
         this.odota(1000); //Virheväri katoaa panosruudusta sekunnin jälkeen
         this.panosruutu.setBackground(PANOSRUUDUN_VARI);
    }

    /**
     * Jos ohjelman vinkkipalvelu käyttäytyy omituisesti, kerrotaan
     * virheilmoitus inforuudussa.
     *
     * @param virheilmoitus Vinkkipalvelun antama virheilmoitus,
     * joka tulostetaan inforuudulla.
     */
    private void virheellinenVinkki(String virheilmoitus) {
         this.korttialue.muutaInforuutua("Vinkkipalvelu on seonnut:\n"+virheilmoitus, true);
         this.odota(3000);
         this.korttialue.muutaInforuutua("", false);
    }

    /**
     * Kun ohjelma päättää sekoittaa pakan, inforuudussa vilahtaa tieto siitä.
     */
    private void ilmoitaPakanSekoittamisesta() {
         this.korttialue.muutaInforuutua("Sekoitetaan pakkaa...", true);
         this.odota(3000);
         this.korttialue.muutaInforuutua("", false);
    }

    /**
     * Muodostetaan ohjelman ohjeet ja Blackjackin säännöt sisältävä ikkuna.
     * Ikkuna on alunperin piilossa.
     */
    private void luoOhjeikkuna() {
         this.ohjeikkuna = new Dialog(this, "Ohjeet");

         TextArea ohjeet = new TextArea("", 10, 40, TextArea.SCROLLBARS_VERTICAL_ONLY);
         ohjeet.setText(Saannot.annaOhjeteksti());
         
         ohjeikkuna.add(ohjeet);
         ohjeikkuna.addWindowListener(new PiilotaOhjeikkuna(this.ohjeikkuna));
         ohjeikkuna.setSize(600,400); //lev, kor
         ohjeikkuna.setVisible(true);
         ohjeikkuna.hide();
    }
}


/**
 * Itse Blackjack-ohjelman sulkemista helpottava luokka
 */
class HoiteleIkkunanSulkeminen extends WindowAdapter {
  public void windowClosing(WindowEvent tapahtuma) {
    System.exit(0);  // ikkunan ja ohjelman sulkeminen  
  }
}

/**
 * Blackjackin ohjeikkunan piilottamista helpottava luokka. Kun
 * ohjeikkuna halutaan sulkea, kutsutaankin tätä ja piilotetaan ikkuna.
 */
class PiilotaOhjeikkuna extends WindowAdapter {
  Dialog ohjeikkuna;
  public PiilotaOhjeikkuna(Dialog ikkuna) {
        this.ohjeikkuna = ikkuna;
  }
  public void windowClosing(WindowEvent tapahtuma) {
      if (this.ohjeikkuna !=null)
          this.ohjeikkuna.hide();
  }
}